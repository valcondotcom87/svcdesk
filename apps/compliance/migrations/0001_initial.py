# Generated by Django 5.2.11 on 2026-02-08 01:03

import datetime
import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('organizations', '__first__'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ComplianceFramework',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('framework', models.CharField(choices=[('ISO27001', 'ISO/IEC 27001:2022 - Information Security Management'), ('ISO9001', 'ISO/IEC 9001:2015 - Quality Management System'), ('ISO20000', 'ISO/IEC 20000:2018 - IT Service Management'), ('NIST_CSF', 'NIST Cybersecurity Framework'), ('NIST_800_53', 'NIST SP 800-53 - Security Controls'), ('NIST_800_171', 'NIST SP 800-171 - Contractor Systems'), ('SOC2', 'SOC 2 - Service Organization Control'), ('GDPR', 'GDPR - General Data Protection Regulation'), ('HIPAA', 'HIPAA - Health Insurance Portability'), ('PCI_DSS', 'PCI-DSS - Payment Card Industry')], max_length=20, unique=True, verbose_name='Framework')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('implemented', 'Implemented'), ('certified', 'Certified'), ('expired', 'Expired')], default='planned', max_length=20, verbose_name='Status')),
                ('version', models.CharField(blank=True, max_length=50, verbose_name='Version')),
                ('target_date', models.DateField(blank=True, null=True, verbose_name='Target Compliance Date')),
                ('certification_date', models.DateField(blank=True, null=True, verbose_name='Certification Date')),
                ('expiry_date', models.DateField(blank=True, null=True, verbose_name='Expiry Date')),
                ('progress_percentage', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Progress Percentage')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='organizations.organization', verbose_name='Organization')),
                ('responsible_person', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='compliance_frameworks', to=settings.AUTH_USER_MODEL, verbose_name='Responsible Person')),
            ],
            options={
                'verbose_name': 'Compliance Framework',
                'verbose_name_plural': 'Compliance Frameworks',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceCheckpoint',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('checkpoint_type', models.CharField(choices=[('quarterly', 'Quarterly Review'), ('annual', 'Annual Audit'), ('incident_review', 'Incident Review'), ('control_testing', 'Control Testing'), ('vulnerability_scan', 'Vulnerability Scan'), ('access_review', 'Access Review'), ('policy_review', 'Policy Review'), ('procedure_review', 'Procedure Review')], max_length=50, verbose_name='Checkpoint Type')),
                ('name', models.CharField(max_length=255, verbose_name='Checkpoint Name')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed - Remediation Required')], default='planned', max_length=20, verbose_name='Status')),
                ('planned_date', models.DateField(verbose_name='Planned Date')),
                ('actual_completion_date', models.DateField(blank=True, null=True, verbose_name='Actual Completion Date')),
                ('frequency', models.CharField(help_text='e.g., Quarterly, Annual, Monthly', max_length=50, verbose_name='Frequency')),
                ('findings', models.TextField(blank=True, verbose_name='Findings')),
                ('issues_identified', models.IntegerField(default=0, verbose_name='Issues Identified')),
                ('issues_resolved', models.IntegerField(default=0, verbose_name='Issues Resolved')),
                ('compliance_score', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Compliance Score (%)')),
                ('evidence_attached', models.URLField(blank=True, help_text='Link to detailed report/evidence', verbose_name='Evidence Link')),
                ('remediation_required', models.BooleanField(default=False, verbose_name='Remediation Required')),
                ('remediation_deadline', models.DateField(blank=True, null=True, verbose_name='Remediation Deadline')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_checkpoints', to=settings.AUTH_USER_MODEL, verbose_name='Assigned To')),
                ('frameworks', models.ManyToManyField(to='compliance.complianceframework', verbose_name='Applicable Frameworks')),
            ],
            options={
                'verbose_name': 'Compliance Checkpoint',
                'verbose_name_plural': 'Compliance Checkpoints',
                'ordering': ['-planned_date'],
            },
        ),
        migrations.CreateModel(
            name='IncidentResponsePlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255, verbose_name='Plan Name')),
                ('description', models.TextField(verbose_name='Description')),
                ('incident_type', models.CharField(help_text='e.g., Data Breach, System Outage, Security Attack', max_length=100, verbose_name='Incident Type')),
                ('severity', models.CharField(choices=[('low', 'Low - User Impact'), ('medium', 'Medium - Department Impact'), ('high', 'High - Multiple Departments'), ('critical', 'Critical - Enterprise Wide')], max_length=20, verbose_name='Severity Level')),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('approved', 'Approved'), ('active', 'Active'), ('archived', 'Archived')], default='draft', max_length=20, verbose_name='Status')),
                ('detection_procedures', models.TextField(help_text='How to detect this type of incident', verbose_name='Detection Procedures')),
                ('initial_response', models.TextField(help_text='Immediate actions to take', verbose_name='Initial Response')),
                ('escalation_path', models.TextField(help_text='Who to contact and in what order', verbose_name='Escalation Path')),
                ('investigation_steps', models.TextField(help_text='Step-by-step investigation procedures', verbose_name='Investigation Steps')),
                ('recovery_procedures', models.TextField(help_text='How to recover from incident', verbose_name='Recovery Procedures')),
                ('communication_template', models.TextField(blank=True, help_text='Template for incident notifications', verbose_name='Communication Template')),
                ('post_incident_review', models.TextField(blank=True, help_text='Lessons learned process', verbose_name='Post-Incident Review')),
                ('secondary_contacts', models.TextField(blank=True, help_text='JSON list of contact details', verbose_name='Secondary Contacts')),
                ('sla_detection', models.DurationField(default=datetime.timedelta(seconds=900), verbose_name='SLA - Detection Time')),
                ('sla_response', models.DurationField(default=datetime.timedelta(seconds=1800), verbose_name='SLA - Response Time')),
                ('sla_resolution', models.DurationField(default=datetime.timedelta(seconds=14400), verbose_name='SLA - Resolution Time')),
                ('version', models.IntegerField(default=1, verbose_name='Version')),
                ('last_reviewed', models.DateField(auto_now=True, verbose_name='Last Reviewed')),
                ('next_review_date', models.DateField(blank=True, null=True, verbose_name='Next Review Date')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_incident_plans', to=settings.AUTH_USER_MODEL, verbose_name='Approved By')),
                ('primary_contact', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='primary_incident_plans', to=settings.AUTH_USER_MODEL, verbose_name='Primary Contact')),
            ],
            options={
                'verbose_name': 'Incident Response Plan',
                'verbose_name_plural': 'Incident Response Plans',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceRequirement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('requirement_id', models.CharField(help_text='e.g., A.8.1.1 for ISO 27001', max_length=50, verbose_name='Requirement ID')),
                ('title', models.CharField(max_length=255, verbose_name='Title')),
                ('description', models.TextField(verbose_name='Description')),
                ('status', models.CharField(choices=[('not_started', 'Not Started'), ('in_progress', 'In Progress'), ('implemented', 'Implemented'), ('verified', 'Verified'), ('non_applicable', 'Non-Applicable')], default='not_started', max_length=20, verbose_name='Status')),
                ('implementation_evidence', models.TextField(blank=True, help_text='Document/proof of implementation', verbose_name='Implementation Evidence')),
                ('due_date', models.DateField(blank=True, null=True, verbose_name='Due Date')),
                ('completion_date', models.DateField(blank=True, null=True, verbose_name='Completion Date')),
                ('related_control', models.CharField(blank=True, max_length=100, verbose_name='Related Control/Document')),
                ('risk_if_not_implemented', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='medium', max_length=20, verbose_name='Risk Level')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('framework', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='requirements', to='compliance.complianceframework', verbose_name='Framework')),
                ('responsible_person', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='Responsible Person')),
            ],
            options={
                'verbose_name': 'Compliance Requirement',
                'verbose_name_plural': 'Compliance Requirements',
                'ordering': ['requirement_id'],
                'unique_together': {('framework', 'requirement_id')},
            },
        ),
        migrations.CreateModel(
            name='ImmutableAuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('create', 'Create'), ('update', 'Update'), ('delete', 'Delete'), ('view', 'View'), ('download', 'Download'), ('login', 'Login'), ('logout', 'Logout'), ('export', 'Export'), ('import', 'Import'), ('approval', 'Approval'), ('rejection', 'Rejection'), ('access_granted', 'Access Granted'), ('access_revoked', 'Access Revoked'), ('config_change', 'Configuration Change'), ('security_event', 'Security Event')], max_length=50, verbose_name='Action')),
                ('timestamp', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='Timestamp')),
                ('content_type', models.CharField(help_text='e.g., Ticket, User, Incident', max_length=100, verbose_name='Content Type')),
                ('object_id', models.CharField(max_length=100, verbose_name='Object ID')),
                ('object_repr', models.CharField(max_length=255, verbose_name='Object Representation')),
                ('changes_made', models.JSONField(blank=True, default=dict, help_text='JSON format: {field: {old: value, new: value}}', verbose_name='Changes Made')),
                ('old_values', models.JSONField(blank=True, default=dict, verbose_name='Old Values')),
                ('new_values', models.JSONField(blank=True, default=dict, verbose_name='New Values')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='IP Address')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='low', max_length=20, verbose_name='Severity')),
                ('compliance_relevant', models.BooleanField(default=True, help_text='Is this log relevant for compliance/audit?', verbose_name='Compliance Relevant')),
                ('data_hash', models.CharField(db_index=True, editable=False, max_length=64, verbose_name='SHA-256 Hash')),
                ('previous_hash', models.CharField(blank=True, editable=False, max_length=64, verbose_name='Previous Log Hash')),
                ('hash_chain_valid', models.BooleanField(default=True, editable=False, verbose_name='Hash Chain Valid')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('reason', models.TextField(blank=True, verbose_name='Reason for Action')),
                ('approval_status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected')], default='pending', max_length=20, verbose_name='Approval Status')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_audit_logs', to=settings.AUTH_USER_MODEL, verbose_name='Approved By')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='audit_logs', to=settings.AUTH_USER_MODEL, verbose_name='User')),
            ],
            options={
                'verbose_name': 'Immutable Audit Log',
                'verbose_name_plural': 'Immutable Audit Logs',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['user', '-timestamp'], name='compliance__user_id_d7a10c_idx'), models.Index(fields=['action', '-timestamp'], name='compliance__action_74b579_idx'), models.Index(fields=['content_type', 'object_id'], name='compliance__content_d9a5dd_idx'), models.Index(fields=['severity', '-timestamp'], name='compliance__severit_9c555c_idx')],
            },
        ),
        migrations.CreateModel(
            name='VulnerabilityTracking',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('vulnerability_id', models.CharField(help_text='CVE, internal ID, or scan ID', max_length=100, unique=True, verbose_name='Vulnerability ID')),
                ('title', models.CharField(max_length=255, verbose_name='Title')),
                ('description', models.TextField(verbose_name='Description')),
                ('affected_system', models.CharField(max_length=255, verbose_name='Affected System/Component')),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], max_length=20, verbose_name='Severity')),
                ('status', models.CharField(choices=[('open', 'Open'), ('acknowledged', 'Acknowledged'), ('in_progress', 'In Progress'), ('resolved', 'Resolved'), ('accepted_risk', 'Accepted Risk'), ('closed', 'Closed')], default='open', max_length=20, verbose_name='Status')),
                ('discovery_date', models.DateField(auto_now_add=True, verbose_name='Discovery Date')),
                ('discovered_by', models.CharField(help_text='Scanner, tool, or person name', max_length=100, verbose_name='Discovered By')),
                ('scan_tool', models.CharField(blank=True, help_text='e.g., Trivy, Bandit, Nessus', max_length=100, verbose_name='Scan Tool')),
                ('cve_reference', models.CharField(blank=True, max_length=100, verbose_name='CVE Reference')),
                ('business_impact', models.TextField(blank=True, verbose_name='Business Impact')),
                ('remediation_effort', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High')], default='medium', max_length=20, verbose_name='Remediation Effort')),
                ('remediation_plan', models.TextField(blank=True, verbose_name='Remediation Plan')),
                ('target_remediation_date', models.DateField(blank=True, null=True, verbose_name='Target Remediation Date')),
                ('actual_remediation_date', models.DateField(blank=True, null=True, verbose_name='Actual Remediation Date')),
                ('risk_acceptance_justification', models.TextField(blank=True, help_text='If accepting risk, explain why', verbose_name='Risk Acceptance Justification')),
                ('acceptance_date', models.DateField(blank=True, null=True, verbose_name='Acceptance Date')),
                ('acceptance_expiry', models.DateField(blank=True, null=True, verbose_name='Acceptance Expiry Date')),
                ('internal_notes', models.TextField(blank=True, verbose_name='Internal Notes')),
                ('verification_steps', models.TextField(blank=True, help_text='How to verify the fix', verbose_name='Verification Steps')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('accepted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='accepted_vulnerabilities', to=settings.AUTH_USER_MODEL, verbose_name='Accepted By')),
                ('responsible_person', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vulnerabilities', to=settings.AUTH_USER_MODEL, verbose_name='Responsible Person')),
            ],
            options={
                'verbose_name': 'Vulnerability Tracking',
                'verbose_name_plural': 'Vulnerability Tracking',
                'ordering': ['-discovery_date'],
                'indexes': [models.Index(fields=['status', 'severity'], name='compliance__status_d3a9f4_idx'), models.Index(fields=['-discovery_date'], name='compliance__discove_1b323d_idx')],
            },
        ),
    ]
